{% extends 'main/base.html' %}

{% block title %}Manager Leave Requests{% endblock %}

{% block content %}
{% if messages %}
<div class="alert alert-info">
    {% for message in messages %}
        <p>{{ message }}</p>
    {% endfor %}
</div>
{% endif %}

<div class="container">
    <h2 class="text-center mb-4">Leave Requests</h2>

    {% if pending_leaves %}
    <h4>Pending Requests</h4>
    <ul class="list-group">
        {% for leave in pending_leaves %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ leave.employee.get_full_name }} - {{ leave.leave_type }} from {{ leave.start_date }} to {{ leave.end_date }}
            <a href="{% url 'leave_manager:approve_or_reject_leave' leave.id %}" class="btn btn-info btn-sm">Approve/Reject</a>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No pending leave requests.</p>
    {% endif %}

    {% if approved_leaves %}
    <h4>Approved Requests</h4>
    <ul class="list-group">
        {% for leave in approved_leaves %}
        <li class="list-group-item">
            {{ leave.employee.get_full_name }} - {{ leave.leave_type }} from {{ leave.start_date }} to {{ leave.end_date }}
            <button class="btn btn-info btn-sm" data-toggle="collapse" data-target="#details-{{ leave.id }}">View Details</button>
            <div id="details-{{ leave.id }}" class="collapse">
                <p><strong>Employee Reason:</strong> {{ leave.reason }}</p>
                <p><strong>Manager Reason:</strong> {{ leave.manager_reason }}</p>
                <p>Comments: {% if leave.comments %}{{ leave.comments }}{% else %}No comments provided{% endif %}</p>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No approved leave requests.</p>
    {% endif %}

    {% if hr_approved_leaves %}
    <h4>HR Approved Requests</h4>
    <ul class="list-group">
        {% for leave in hr_approved_leaves %}
        <li class="list-group-item">
            {{ leave.employee.get_full_name }} - {{ leave.leave_type }} from {{ leave.start_date }} to {{ leave.end_date }}
            <p><strong>Status:</strong> Approved by HR</p>
            <button class="btn btn-info btn-sm" data-toggle="collapse" data-target="#details-{{ leave.id }}">View Details</button>
            <div id="details-{{ leave.id }}" class="collapse">
                <p><strong>Employee Reason:</strong> {{ leave.reason }}</p>
                <p><strong>Manager Reason:</strong> {{ leave.manager_reason }}</p>
                <p>Comments: {% if leave.comments %}{{ leave.comments }}{% else %}No comments provided{% endif %}</p>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No HR approved leave requests.</p>
    {% endif %}

    {% if rejected_leaves_by_manager %}
    <h4>Rejected by Manager</h4>
    <ul class="list-group">
        {% for leave in rejected_leaves_by_manager %}
        <li class="list-group-item">
            {{ leave.employee.get_full_name }} - {{ leave.leave_type }} from {{ leave.start_date }} to {{ leave.end_date }}
            <button class="btn btn-info btn-sm" data-toggle="collapse" data-target="#details-{{ leave.id }}">View Details</button>
            <div id="details-{{ leave.id }}" class="collapse">
                <p><strong>Employee Reason:</strong> {{ leave.reason }}</p>
                <p><strong>Manager Reason:</strong> {{ leave.manager_reason }}</p>
                <p>Comments: {% if leave.comments %}{{ leave.comments }}{% else %}No comments provided{% endif %}</p>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No leave requests rejected by manager.</p>
    {% endif %}

    {% if rejected_leaves_by_hr %}
    <h4>Rejected by HR</h4>
    <ul class="list-group">
        {% for leave in rejected_leaves_by_hr %}
        <li class="list-group-item">
            {{ leave.employee.get_full_name }} - {{ leave.leave_type }} from {{ leave.start_date }} to {{ leave.end_date }}
            <button class="btn btn-info btn-sm" data-toggle="collapse" data-target="#details-{{ leave.id }}">View Details</button>
            <div id="details-{{ leave.id }}" class="collapse">
                <p><strong>Employee Reason:</strong> {{ leave.reason }}</p>
                <p><strong>Manager Reason:</strong> {{ leave.manager_reason }}</p>
                <p>Comments: {% if leave.comments %}{{ leave.comments }}{% else %}No comments provided{% endif %}</p>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No leave requests rejected by HR.</p>
    {% endif %}

</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
